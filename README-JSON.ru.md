Описание формата файла cards.json
=================================

При запуске с файлом `cards.pon` `GameGen.py` конвертирует его в `cards.json` и кладёт в папочку рядом с `cards.pon`, после чего можно переключиться на него и работать уже с ним.

В файле содержится словарь, у которого есть два обязательных ключа:

- `module` — название модуля, генерирующего карты (проверялось только с `TSSSF_CardGen`, со совместимость с другими модулями пытался не ломать)

- `cards` — список самих карт для рисования.

Помимо этого, есть несколько необязательных ключей, но о них ниже.


Карта
-----

Карта — это словарь, в котором указываются тип карты (`type`) и различные параметры для генерации, зависящие от конкретного типа карты.

START, Pony, Ship, Goal — основные типы карт. Все они имеют следующие параметры:

- `type` — обязательный параметр.

- `picture` — название картинки с артом или (для типа Card) самой картой, ищется в TSSSF/Card Art

- `overlay` — название картинки, которая будет наложена поверх всей остальной картинки (даже поверх символов), ищется в TSSSF/Card Art

- `symbols` — список символов, рисуемых рядом с артом. Порядок рисования зависит от типа карты.

- `timeline_symbol` — символ в левом нижнем углу арта.

- `title`, `keywords`, `body`, `flavor`, `expansion`

- `client` — кусок текста, добавляемый в копирайте к набору карт.

- `artist` — кусок текста, указывающий в копирайте автора арта (Pixel Prism).

Пример карты:

{"type": "Pony", "picture": "Pony - Star Student Twilight Sparkle.png", "symbols": ["Female", "Unicorn"], "title": "Star Student Twilight", "keywords": "Mane 6, Twilight Sparkle", "body": "Totally Not Cheating (Copy): {copy}", "flavor": "\"W-what? This cannot be!\" Trixie stood aghast over the masterful masterpieces Twilight had laid out in runic scrawl on her desk, \"Nopony could solve The Last Riddle! And in such an elegant way... It's IMPOSSIBLE!\"\n- Element of Magic: An Autobiography"}

Для кастомизации также можно добавить следующие параметры:

- `copyright` — сам копирайт. Если его указать, то `client` игнорируется.

- `frame` — фон передней части карты, указывается  формате пути (см. ниже)

- `back` — аналогично для задней части карты

- `fonts` — словарь для замены шрифтов на свои. Этот словарь содержит ключи с типом текста, у котогоро надо заменить шрифт, и значения в формате пути, но с дописанным размером шрифта (см. ниже). Поддерживаются следующие типы:

 - `Title`
 - `TitleSmall` — используется, если заголовок слишком большой и не влезает
 - `Body`
 - `BodySmall` — аналогично TitleSmall
 - `BodyChangeling` — как BodySmall, но ещё мельче
 - `Bar`
 - `BarSmall`
 - `Flavortext`
 - `Copyright`
 - Пример: `"fonts": {"Flavor": ["resource", "arialbd.ttf", 40]}`

- `colors` — словарь для замены цветов текста. Цвет указывается в виде трёх чисел от 0 до 255 в формате RGB. Поддерживаемые типы:

 - `main` — цвет для `Title` и `Body`
 - `bar text`
 - `flavor`
 - `Copyright`
 - Пример: `"colors": {"main": [0, 255, 0], "flavor": [255, 100, 100]}`

- `anchors` — для указания координат [икс, игрек] для различных элементов карты:

 - `PonyArt`, `ShipArt`, `GoalArt`
 - `Symbol1`, `Symbol2`, `TimelineSymbol` для карт `START`, `Pony` и `Ship`
 - `LoneSymbol`, `GoalSymbol2` для карт `Goal`
 - `Title`, `TitleTwoLine`, `TitleSmall`
 - `Bar`
 - `Body`
 - `BodyShiftedUp`
 - `Flavor`
 - `Expansion`
 - `Copyright`
 - Для текста можно указывать отрицательные значения — тогда отсчёт будет вестить от противоположного края картинки (-1 — самый правый или самый нижний пиксель, -2 — отступ в 1 пиксель от края и т.д.)
 - Пример: `"anchors": {"Body": [150, 450]}`

- `anchors_offset` — аналогично `anchors` с той разницей, что знчение не берётся как есть, а складывается со значением по умолчанию или, если указано в карте, со значением из `anchors`.

 - Пример: `"anchors_offset": {"Flavor": [0, 1]}`

- `leading` — интервал между строками (в пикселях) для текстов следующих типов:

 - `Title` (по умолчанию -9)
 - `TitleTwoLine` (-15)
 - `Body` (-1)
 - `BodyChangeling` (-3)
 - `Flavor` (1)
 - Пример: `"leading": {"Body": -5}`

- `extension` — формат файла, в который будет сохранена карта, по умолчанию png. bmp и jpg очень сильно ускоряют генерацию карт, но первый много весит, а у второго плохое качество.

Ещё есть типы карт `Card` (с одним параметром `picture`), `Rules1`, `Rules3`, `Rules5`, а также `BLANK` вообще без параметров.


Формат путей
------------

Для параметров `frame`, `back` и `fonts` нужно указывать путь к файлам. Чтобы не привязывать путь к именам папок, он записывается в следующем формате:

`[тип, путь]` или для fonts `[тип, путь, размер шрифта]`

Тип указывает, в какой папке искать файл:

 - `resource` — TSSSF/resources
 - `card_art`: TSSSF/Card Art
 - `local`: TSSSF/название набора

Также есть альтернативный синтаксис: просто указание строки с названием файла, а не список. Такой файл будет искаться в TSSSF/resources.

Размер шрифта не обязателен для указания — при его отсутствии будет взят размер по умолчанию.


Группировка параметров
----------------------

Все описанные выше параметры применяются для каждой карты отдельно. Чтобы не заниматься их одним копипастом из карты в карту, имеется механизм группировки карт. Для этого в списке карт вместо самой карты надо объявить группу в таком формате:

`{"group": {словарь общих параметров}, "cards": [карты]}`

Например:

{"group": {"back": ["resource", "Back - Ship.png"]}}, "cards": [{"type": "Card", "picture": "Derpy"}]}

Так у всех карт в `cards` будет заменена картинка на задней стороне.

Группы можно бесконечно вкладывать друг в друга. При этом указанные в группах параметры будут объединяться, а не замещаться.

Если у карты или группы есть параметр, который уже указан в родительской группы, то он будет браться из самой карты/группы, а не из родительской (то есть в общем имеется нормальное наследование).

Чтобы указать параметры для всех карт сразу, можно не обводить их всех в группу, а указать общие параметры в `default`, вот так:

{"module": "TSSSF_CardGen", "default": {"extension": "jpg"}, "cards": [...]}

Так все карты будут сохранены в jpg.


Выбор карт для генерации
------------------------
Если надо по-быстрому проверить какую-то отдельную карту или временно отключить битые карты, то есть параметры карт `focus` и `disable`.

- Если хотя бы у одной карты указан `"focus": true`, то будут сгенерированы только карты с этим параметром вместо всех. Параметр `disable` при это игнорируется, что важно учитывать в группах.

- Если параметра `focus` ни у кого нет, то рисуются все карты, кроме `"disable": true`.

- Если у одной и той же карты есть `"focus": true` и `"disable": true`, то `disable` игнорируется и она рисуется.


Свои символы
------------

В файле можно указать `"symbols": {"название": "файл в ресурсах.png", ...}` для загрузки и использования своих символов.


Параметры pdf
-------------

В файл можно добавить ключик `pdf` и указать в нём параметры экспорта в PDF:

 - `extension` — формат изображений, которые будут собраны в pdf, по умолчанию png. Не обязательно совпадает с форматом карт.
 - `page` — [длина, ширина] страницы в дюймах. Для A4 это примерно [8.267, 11.692]
 - `cut_line_width` — толщина линий между картами в пикселях
 - `grid` — [столбцы, строки] — число карт на странице, по умолчанию [3, 3]
